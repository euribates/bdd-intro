<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Introducción a BDD (Behevior-Driven Development)</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				
                <section>
                    <h3>Uno introducción a BDD</h3>
                    <h5>Behavior Driven Development</h5>
                </section>


                <section>

                    <section>
                        <h4><code>whoami</code></h4>

                            <p>Juan Ignacio Rodríguez de león<p>
                            <p><code>@jileon</code> en Twitter<p>
                            <p>Backend developer en 
                            <a href="https://octopuslabs.com/">OctopusLabs</a><p>
                            <p>
                                <img border="0" style="padding:1em;"
                                    src="./logos/logo-labs.svg"></p>
                    </section>
    
                    <section>
                        <h4><code>banner</code></h4>

                        <h3>We are hiring</h3>

                        <p>Más info es:</p>
                        <p><code><a href="https://octopuslabs.com/careers">
                                https://octopuslabs.com/careers
                            </a></code></p>
                        <aside class="notes">
                            joke 3
                        </section>

                </section>


				<section>
                    <h4><code>tree</code></h4>
                    <h5>Como se estructura esta charla</h5>
                    <p>Se divide en tres partes:</p>
                    <ul>
                        <li class="fragment">Teoria</li>
                        <li class="fragment">Ejemplo práctico</li>
                        <li class="fragment">Librerías, herramientas,
                            recomendaciones...</li>
                    </ul>
                        <aside class="notes">
                           Para hacer la charla más amena, saltaremos
                           de la parte teórica a la práctica y 
                           vuelta.
                        </section>
                </section>

            <section>

                <section>
                    <h5><code>man</code></h5>
                    <h4>Qué es BDD</h4>
                    <p>Según wikipedia:</p>
                    <cite><small>
                        ... an extension of TDD that makes use of a simple, 
                        domain-specific scripting language structured like 
                        natural language statements to ensures all development
                        projects remain focused on delivering what the business
                        actually needs while meeting all requirements.
                            </small></cite>
                    
                </section>

                <section>
                    <h5><code>man</code></h5>
                    <h4>Qué es BDD</h4>
                    <p>Según wikipedia:</p>
                    <cite><small><strike>
                        ... an extension of TDD that makes use of a simple, 
                        domain-specific scripting language structured like 
                        natural language statements to ensures all development
                        projects remain focused on delivering what the business
                        actually needs while meeting all requirements.
                            </strike></small></cite>
                </section>

                <section id="after_hello_bdd">
                    <h4>tldr</h4>
                    <ul>
                        <li>Son tests. Igual que con TDD, usamos test para
                            dirigir <b class="fragment highlight-green">el
                            diseño</b></li>
                        <li>Suelen ser test de <b class="fragment highlight-green">
                            más alto nivel</b> que TDD</li>
                        </li>Están escritos en un <b class="fragment highlight-green">lenguaje
                            natural</b> (Español,
                        Inglés...)</li>
                    </ul>
                    <p><a href="#/hello_bdd">Ejemplo</a></p>

                </section>

                <section>
                    <h4>Objetivo: Compartir conocimiento</h4>
                    <p>El lenguaje natural:</p>
                    <ul>
                        <li>Lenguaje <b class="fragment highlight-green">común</b> entre todos</li>
                        <li><b class="fragment highlight-green">Cualquiera</b>
                            puede definir u opinar
                            sobre un test</li>
                        <li>Aclarar y <b class="fragment highlight-green">debatir
                                sobre zonas típicamente
                                conflictivas</b>: casos límite, excepciones...</li>
                    </ul>
                </section>

                <section>
                    <h4>Especificaciones ejecutables</h4>
                    <p>Si usamos estos tests como las especificaciones
                    que debe cumplir nuestro software, tenemos especificaciones
                    <b class="fragment highlight-green">
                        escritas en lenguaje natural, pero ejecutables</b>.
                </section>

                <section>
                    <h4>¿Cómo que ejecutables?</h4>
                    <p>Vamos a convertir esta especificacion natural en un 
                    test</p>
                    <p><a href="#/install-behave">Ejemplo</a></p>

                </section>

                <section id="after-install-behave">
                    <h3>Tenemos test</h3>
                    <ul>
                    <li>Claro, ahora hay que implementarlos, no hay magia</li>

                    <li>Pero antes, veamos un poco más acerca de estos
                    ficheros y su organización</li>
                    </ul>

                </section>

                <section>
                    <h4>Gherkin</h4>
                   
                    <p> El formato que usamos para las especificaciones se
                    denomina <b>Gherkin</b>.  </p>
                    
                    <p>Hay una serie de palabras reservadas que tienen un
                    significado especial: <code><b>Feature</b></code>,
                    <code><b>Scenario</b></code>, <code><b>Given</b></code>,
                    <code><b>When</b></code> y <code><b>Then</b></code>.</p>

                    <p>(y <code><b>And</b></code>
                    y <code><b>But</b></code>) </p>

                </section>

                <section>
                    <h4>Feature</h4>

                    <ul>
                        
                    <li>Cada <i>feature</i> o capacidad que nos de el sistema
                        deberia tener su propio fichero
                        <code>.feature</code>.</li>
                    
                    <li>La palabra clave Feature ira al pricincio y sirve para
                        describir en una sola linea que parte del sistema
                        estamos probando.</li>

                    <li>Cualquier texto entre Feature y el primer escenario
                        sirve para describirlo de forma mas completa.</li>
                    
                    </ul> </section>

                <section>
                    <h4>Scenario</h4>

                    <ul>

                        <li> Normalmente una funcionalidad del sistema tiene
                            más de un escenario, porque nos interesa probar el
                            sistema en diferentes condiciones, con diferentees
                        entradas, etc...</li>   

                        <li> Cada escenario se define con la palabra clave
                            <b>Scenario</b></li>

                        <li> Consiste en un ejemplo completo de uso de la
                            feature </li>

                    </ul>
                </section>

                <section>
                    <h4>Given</h4>
                    <ul>
                        <li><b>Given</b> pone el sistema en un estado
                            conocido y controlado antes de empezar a
                            interactuar con él</li>
                        <li>No debería haber interacciones de usuario aquí</li>
                    </ul>
                </section>

                <section>
                    <h4>When</h4>
                    <ul>
                        <li><b>When</b> Llevamos a cabo la accion que
                            el usuario o un sistema externo quiere ejecutar.
                            Esto deberá provocar algún cambio en el
                            sistema</li>
                        <li>O no</li>
                    </ul>
                </section>

                <section>
                    <h4>Then</h4>
                    <ul>
                        <li><b>Then</b> Comprobamos que la salida sea
                        la esperada</li>
                    </ul>
                </section>

                <section>
                    <h4>Volvamos a la parte práctica</h4>
                    <h5>Implementemos los test</h5>
                        <p><a href="/#simple_test">Ejemplo</a></p>
                </section>

                <section id="after_simple_test">
                    <h4>Alguna cosas interesantes<br>
                    <small>de los steps</small></h4>

                    <ul>
                        <li>El nombre de la funcion a la hora de definir los
                        steps o pasos <b>no</b> es importante</li>
                        <li>Behave decide que funciones llamar y cuando
                        en base al texto del decorador</li>
                        <li>La idea es que los steps sean reutilizables</li>
                    </ul>
                </section>

                <section>
                    <h4>Captura de parámetros</h4>
                    <ul>
                        <li>Para eso, una caracteristica importante
                        es que podemos hacer los pasos parametrizables,
                        y capturar del texto datos para el test.</li>
                    </ul>
                        <p><a href="/#param_test">Veámoslo con otro ejemplo</a></p>

                </section>

                <section>
                    <h4>Diferencias con TDD</h4>
                    <ul>
                        <li>El enfasis no es en el código, sino en 
                        la funcionalidad proporcionada</li>

                        <li>Especificación en lenguajes natural</li>

                        <li>Común a todo el equipo: Desarrolladores,
                        testers, Q/A, product owners, analistas de
                        negocio...</li>
                    </ul>
                </section>

            </section>

            <section>
                <section>
                    <h4>Parte práctica</h4>
                </section>

                <section>
                    <h4>Un ejemplo de fichero .feature</h4>
                </section>

                <section id="hello_bdd">
                    <pre><code>
    Feature: Transfer between accounts

      Scenario: Add savings

        Given I have 10.000€ in my current acount
        And I have 300€ in my saving accout
        When I transfer 200€ from current to saving
        Then I should have 9.800€ in my current acount
        And I should have 500€ in my saving acount
                    </code></pre>

                    <p><a href="#/after_hello_bdd"> ◀ </a></p>

                </section>

                <section id="install-behave">
                    <h4>Instalemos behave</h4>

                    <p><small>Behave es una implementacion de herramienta BDD
                        escrita en Python, veremos otras opciones para otros
                        lenguajes al final de la charla</small></p>

                </section>

                <section>
                    <pre><code>
    pip install behave
                    </code></pre>
                </section>

                <section>
                    <h4>Para Nuestro primer test BDD
                    <small>vamos a necesitar...</small></h4>

                    <ul>
                        
                        <li>Un directorio <code><b>features</b></code></li>
                        
                        <li>dentro, un fichero llamado
                            <code><b>transfer-between-accounts.feature</b></code>*
                            </li>
                    
                            <li>y un directorio <code><b>steps</b></code>.</li>
                           
                    </ul>
                    <p><small>* con el contenido del ejemplo anterior</small></p>


                </section>

                <section>
                    <pre><code>
mkdir features
mkdir features/steps
vim features/transfer-between-accounts.feature
                    </code> </pre>
                </section>


                <section>

                    <h4>Ya hemos escrito el primer test<br>
                        <small>ya es ejecutable</small></h4>
                   
                    <p>Ejecutamos, simplemente:</p>

                    <pre><code>
    behave
                    </code></pre>

                </section>

                <section>

                    <pre><code>
Feature: Transfer between accounts # features/transfer-between-accounts.feature:1

  Scenario: Add savings                           # features/transfer-between-accounts.feature:3
    Given I have 10000€ in my current acount      # None
    And I have 300€ in my saving accout           # None
    When I transfer 200€ from current to saving   # None
    Then I should have 9800€ in my current acount # None
    And I should have 500€ in my saving acount    # None


Failing scenarios:
  features/transfer-between-accounts.feature:3  Add savings

0 features passed, 1 failed, 0 skipped
0 scenarios passed, 1 failed, 0 skipped
0 steps passed, 0 failed, 0 skipped, 5 undefined
Took 0m0.000s                             
                    </code></pre>
                </section>

                <section>
                    <pre><code>

You can implement step definitions for undefined steps with these snippets:

@given(u'I have 10000€ in my current acount')
def step_impl(context):
    raise NotImplementedError(u'STEP: Given I have 10000€ in my current acount')

@given(u'I have 300€ in my saving accout')
def step_impl(context):
    raise NotImplementedError(u'STEP: Given I have 300€ in my saving accout')

@when(u'I transfer 200€ from current to saving')
def step_impl(context):
    raise NotImplementedError(u'STEP: When I transfer 200€ from current to saving')

@then(u'I should have 9800€ in my current acount')
def step_impl(context):
    raise NotImplementedError(u'STEP: Then I should have 9800€ in my current acount')

@then(u'I should have 500€ in my saving acount')
def step_impl(context):
    raise NotImplementedError(u'STEP: Then I should have 500€ in my saving acount')

                    </code></pre>
                </section>
                 
                <section>
                    <h4>Funciona</h4>
                    <p>Incluso nos sugiere unos "esqueletos" de
                    funiones para nosotros implemtar los test</p>

                    <p><a href="#/after-install-behave" target="_blank"> ◀ </a></p>
                </section>

                <section id="simple_test">
                    <h4>Test simple</h4>

                    <ul>
                        <li>Veamos una primera implmentación
                        </li>

                        <li>Como no tenemos realmente codigo que probar,
                        es una simulación</li>

                    </ul>
                </section>

                <section>
                    <h4>Given...</h4>
                    <pre><code>
#!/usr/bin/env python

from behave import *

@given("I have 10000€ in my current acount")
def step_impl(context):
    context.current_account = 10000


@given("I have 300€ in my saving accout")
def step_impl(context):
    context.savings_account = 300                    

                    </code></pre>
                </section>

                <section>
                    <h4>When...</h4>
                    <pre><code>
@when("I transfer 200€ from current to saving")
def step_impl(context):
    context.savings_account += 200
    context.current_account -= 200                    
                    </code></pre>
                </section>

                <section>
                    <h4>Then...</h4>
                    <pre><code>
@then("I should have 9800€ in my current acount")
def step_impl(context):
    assert context.current_account == 9800

@then("I should have 500€ in my saving acount")
def step_impl(context):
    assert context.savings_account == 500                    
                    </code></pre>
                </section>

                <section>
                    <h4>Ejecutamos Behave</h4>
                    <pre><code>
Feature: Transfer between accounts # features_002/transfer-between-accounts.feature:1

  Scenario: Add savings                           # features_002/transfer-between-accounts.feature:3
    Given I have 10000€ in my current acount      # features_002/steps/financial.py:5 0.000s
    And I have 300€ in my saving accout           # features_002/steps/financial.py:10 0.000s
    When I transfer 200€ from current to saving   # features_002/steps/financial.py:15 0.000s
    Then I should have 9800€ in my current acount # features_002/steps/financial.py:21 0.000s
    And I should have 500€ in my saving acount    # features_002/steps/financial.py:25 0.000s

1 feature passed, 0 failed, 0 skipped
1 scenario passed, 0 failed, 0 skipped
5 steps passed, 0 failed, 0 skipped, 0 undefined
Took 0m0.000s
                    
                    </code></pre>
                </section>

                <section>
                    <a href="/#after_simple_test">Up poco más de teoría</a>
                </section>

                <section id="param_test">
                    <h4>Pasos parametrizables</h4>
                    <ul>
                        <li>Podemos parsear las cadena de texto de los
                            ejemplos y extraer informacion para los test
                        </li>
                        <li>Por defecto se usa una libreria llamada
                        <a href="https://pypi.org/project/parse/">parse</a>, que
                        se define como <i>parse() is the opposite of
                            format()</i></li>
                    </ul>
                </section>

                <section>
                    <p>cambiar la definion del primer paso de</p>
                    <pre><code>
@given("I have 10000€ in my current acount")
def step_impl(context):
    context.current_account = 10000                    
                    </code></pre>
                    <p>A</a></p>
                    <pre><code>
@given("I have {amount}€ in my current acount")
def step_impl(context, amount):
    context.current_account = int(amount)
                    </code></pre>

                </section>

            </section>

			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
                history: true,
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
            Reveal.configure({ slideNumber: 'c/t' });
		</script>
	</body>
</html>
