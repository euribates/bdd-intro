<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Introducción a BDD (Behevior-Driven Development)</title>

		<link rel="stylesheet" href="lib/css/reveal.css">
		<link rel="stylesheet" href="lib/css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = 'lib/css/print/' + (
                window.location.search.match(/print-pdf/gi)?'pdf.css':'paper.css'
                );
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				
                <section>
                    <h2>Introduction to BDD</h2>
                    <h5>Behavior Driven Development</h5>
                </section>


                <section>

                    <section>
                        <img src="covers/namor-50-who-am-i.png" alt="Who am I">
                    </section>

                    <section>
                        <h4><code>whoami</code></h4>

                            <p>Juan Ignacio Rodríguez de león<p>
                            <p><code>@jileon</code> en Twitter<p>
                            <p>Backend developer en 
                            <a href="https://octopuslabs.com/">OctopusLabs</a><p>
                            <p>
                                <img border="0" style="padding:1em;"
                                    src="./logos/logo-labs.svg"></p>
                    </section>
    
                    <section>
                        <h5>We are hiring</h5>

                        <p>More info at:</p>
                        <p><code><a href="https://octopuslabs.com/careers">
                                https://octopuslabs.com/careers
                            </a></code></p>
                        <aside class="notes">
                            joke 3
                        </section>

                    <section>
                        <h5>How is this talk structured?</h5>
                        <ul>
                            <li class="fragment">Presentation (Finished!)</li>
                            <li class="fragment">Teory</li>
                            <li class="fragment">Practice</li>
                            <li class="fragment">Libraries, tools, recomendations...</li>
                        </ul>
                            <aside class="notes">
                                for the purpose of clarity, we
                                will jump from theory to practice
                                and back (and forth) 
                            </aside>
                    </section>

                </section>



            <section>

                <section>
                    <h4>Teoría</h4>
                    <img src="covers/theory.png" alt="Theory">
                </section>

                <section>
                    <blockquote>
                    In theory, there is no difference between theory and practice. In practice,
                    there is.
                    <br>--
                    <br>Benjamin Brewster 
                    </blockquote>
                </section>

                <section>
                    <h4>What is BDD</h4>
                    <p>As stated by wikipedia:</p>
                    <cite><small>
                        ... an extension of TDD that makes use of a simple, 
                        domain-specific scripting language structured like 
                        natural language statements to ensures all development
                        projects remain focused on delivering what the business
                        actually needs while meeting all requirements.
                            </small></cite>
                    
                </section>

                <section>
                    <h5><code>man</code></h5>
                    <h4>Waht is BDD</h4>
                    <p>As stated by wikipedia:</p>
                    <cite><small><strike>
                        ... an extension of TDD that makes use of a simple, 
                        domain-specific scripting language structured like 
                        natural language statements to ensures all development
                        projects remain focused on delivering what the business
                        actually needs while meeting all requirements.
                            </strike></small></cite>
                </section>

                <section id="after_hello_bdd">
                    <h4>tldr</h4>
                    <ul>
                        <li>They are tests. As in TDD, we use test to drive 
                            <b class="fragment highlight-green">the
                            design</b> of the software</li>
                        <li>Usually, on a <b class="fragment highlight-green">higher level</b> than 
                            TDD</li>
                        </li>Written in a <b class="fragment highlight-green">natural lenguage
                    </b>, like English</li>
                    </ul>
                    <p><a href="#/hello_bdd">Example</a></p>

                </section>

                <section>
                    <h4>Target: Share knowledge</h4>
                    <p>A natural lenguaje:</p>
                    <ul>
                        <li>Is used <b class="fragment highlight-green">for all of us</b></li>
                        <li><b class="fragment highlight-green">Everyone</b>
                            can define, debate o improve a test</li>
                        <li>Allow all the team to <b class="fragment highlight-green">discuss
                                on tipically conflictive topics</b>: edge cases, exceptions...</li>
                    </ul>
                </section>

                <section>
                    <h4>Executable Specifications</h4>
                    <p>Using this test as specifications for our software, we get
                    specifications <b class="fragment highlight-green">
                        written on a plain english, but executables</b>.
                </section>

                <section>
                    <h4>How can you "execute" english?</h4>
                    <p>Lets transform a plain english specification in a  
                    test</p>
                    <p><a href="#/install-behave">Example</a></p>

                </section>

                <section id="after-install-behave">
                    <h3>Now we have tests!</h3>
                    <ul>
                    <li>But, obviously, we need to implement the code. No black magic</li>

                    <li>Before that, lets review a few details about files and organization.</li>
                    </ul>

                </section>

                <section>
                    <h4>Gherkin</h4>
                   
                    <p>The format used in this specification is called <b>Gherkin</b></p>
                    
                    <p>There are just a few words that have a special meaning:
                    <code><b>Feature</b></code>,
                    <code><b>Scenario</b></code>,
                    <code><b>Given</b></code>,
                    <code><b>When</b></code> y
                    <code><b>Then</b></code>.</p>

                    <p>(Also <code><b>And</b></code>,
                    <code><b>But</b></code>)</p>

                </section>

                <section>
                    <h4>Feature</h4>

                    <ul>
                        
                    <li>Every <i>feature</i> is a capacity of our product. Each feature
                        must have its own <code>.feature</code> file</li>
                    
                    <li>The keyword <b>Feature</b> must go at the begining, and
                        gives us the opportunity to descrive the feature in one line
                        </li>

                    <li>The rest of text between the feature line and the first
                        scenario can be used to describe the feature with more
                        detail</li>
                    
                    </ul> </section>

                <section>
                    <h4>Scenario</h4>

                    <ul>

                        <li> Usually, a feature has more than one scenario, because
                            we are interested on testing diferent aspects: changing
                            conditiones, edge cases, different inputs, etc...</li>   

                        <li> Every diferent case is defined with the keyboard 
                            <b>Scenario</b></li>

                        <li> As a rule, every scenario is a complete and concrete example 
                            of a feature</li>

                    </ul>
                </section>

                <section>
                    <h4>Given</h4>
                    <ul>
                        <li><b>Given</b> put our system in a known and controled 
                            state, before the first intereaction.</li>
                        <li>(No user interactions if this part)</li>
                    </ul>
                </section>

                <section>
                    <h4>When</h4>
                    <ul>
                        <li><b>When</b> This is where we describe the actions
                            the user or external system wants to do. This
                            must yield some changes in the system.
                            </li>
                        <li>Or maybe not</li>
                    </ul>
                </section>

                <section>
                    <h4>Then</h4>
                    <ul>
                        <li><b>Then</b> This is where we check that the outcomes of our
                            system are the expected</li>
                    </ul>
                </section>

                <section>
                    <h4>And y But</h4>
                    <p><b>And </b>y <b>But </b> are alternative versions of
                    Given and Then, just to get a better feeling of proper english.
                    So, instead of writing:</p>
                    <pre><code>
Given I have 10000€ in my current acount
Given I have 300€ in my saving accout
                    </code> </pre>
                    <p>Wa can write:</p>
                    <pre><code>
Given I have 10000€ in my current acount
And I have 300€ in my saving accout
                    </code> </pre>
                </section>

                <section>
                    <h4>Go back to practice</h4>
                    <h5>Lets implement the test</h5>
                        <p><a href="/#simple_test">Example</a></p>
                </section>

                <section id="after_simple_test">
                    <h4>A few interesting details<br>
                    <small>on steps</small></h4>

                    <ul>
                        <li>The name of the function used to implemente the steps 
                        <b class="fragment highlight-green">it's not important!</b></li>
                        <li>Behave decide what funciones to call, and when, based
                            only in the text of decorator</li>
                        <li>Main idea is having <b class="fragment highlight-green">reusable steps</li>
                    </ul>
                </section>

                <section>
                    <h4>Request</h4>
                    <ul>
                        <li>Every step has a common first parameter called
                        <code>request</code>, that could be used for
                        Sharing data</li>
                        <li>This data can be shared at a feaure level or a scenario level</li>
                    </ul>
                </section>

                <section>
                    <h4>Parameter Capture</h4>
                    <ul>
                        <li>One interesting ability is to "capture" some
                            part of the text of the step</li>
                        <li> This allow us to have parametrizable, and hence,
                            more reusable steps</li>
                    </ul>
                        <p><a href="/#param_test">Lets see this with another example</a></p>

                </section>

                <section>
                    <h4>Diferencias con TDD</h4>
                    <ul>
                        <li>El enfasis no es en el código, sino en 
                        la funcionalidad proporcionada</li>

                        <li>Especificación en lenguajes natural</li>

                        <li>Común a todo el equipo: Desarrolladores,
                        testers, Q/A, product owners, analistas de
                        negocio...</li>
                    </ul>
                </section>

            </section>

            <section>
                <section>
                    <h4>Practice</h4>
                    <img src="covers/practice.png" alt="Practice">
                </section>

                <section>
                    <h4>A feature file example</h4>
                </section>

                <section id="hello_bdd">
                    <pre><code>
    Feature: Transfer between accounts

      Scenario: Add savings

        Given I have 10.000€ in my current acount
        And I have 300€ in my saving accout
        When I transfer 200€ from current to saving
        Then I should have 9.800€ in my current acount
        And I should have 500€ in my saving acount
                    </code></pre>

                    <p><a href="#/after_hello_bdd"> ◀ </a></p>

                </section>

                <section id="install-behave">
                    <h4>Instalemos behave</h4>

                    <p><small>Behave es una implementacion de herramienta BDD
                        escrita en Python, veremos otras opciones para otros
                        lenguajes al final de la charla</small></p>

                </section>

                <section>
                    <pre><code>
    pip install behave
                    </code></pre>
                </section>

                <section>
                    <h4>For our first BDD test...
                    <small>We are going to need ...</small></h4>

                    <ul>
                        
                        <li>A <code><b>features</b></code> directory</li>
                        
                        <li>Inside, a file named
                            <code><b>transfer-between-accounts.feature</b></code>*
                            </li>
                    
                            <li>and a directoriy named <code><b>steps</b></code>.</li>
                           
                    </ul>
                    <p><small>* with the content show in the previous example</small></p>


                </section>

                <section>
                    <pre><code>
mkdir features
mkdir features/steps
vim features/transfer-between-accounts.feature
                    </code> </pre>
                </section>


                <section>

                    <h4>First test written!<br>
                        <small>And it is executable!</small></h4>
                   
                    <p>To execute it, just type on the command line:</p>

                    <pre><code>
    behave
                    </code></pre>

                </section>

                <section>

                    <pre><code>
Feature: Transfer between accounts # features/transfer-between-accounts.feature:1

  Scenario: Add savings                           # features/transfer-between-accounts.feature:3
    Given I have 10000€ in my current acount      # None
    And I have 300€ in my saving accout           # None
    When I transfer 200€ from current to saving   # None
    Then I should have 9800€ in my current acount # None
    And I should have 500€ in my saving acount    # None


Failing scenarios:
  features/transfer-between-accounts.feature:3  Add savings

0 features passed, 1 failed, 0 skipped
0 scenarios passed, 1 failed, 0 skipped
0 steps passed, 0 failed, 0 skipped, 5 undefined
Took 0m0.000s                             
                    </code></pre>
                </section>

                <section>
                    <pre><code>

You can implement step definitions for undefined steps with these snippets:

@given(u'I have 10000€ in my current acount')
def step_impl(context):
    raise NotImplementedError(u'STEP: Given I have 10000€ in my current acount')

@given(u'I have 300€ in my saving accout')
def step_impl(context):
    raise NotImplementedError(u'STEP: Given I have 300€ in my saving accout')

@when(u'I transfer 200€ from current to saving')
def step_impl(context):
    raise NotImplementedError(u'STEP: When I transfer 200€ from current to saving')

@then(u'I should have 9800€ in my current acount')
def step_impl(context):
    raise NotImplementedError(u'STEP: Then I should have 9800€ in my current acount')

@then(u'I should have 500€ in my saving acount')
def step_impl(context):
    raise NotImplementedError(u'STEP: Then I should have 500€ in my saving acount')

                    </code></pre>
                </section>
                 
                <section>
                    <h4>Funciona</h4>
                    <p>It gives us a scheleton functions for us to implmente the tests </p>

                    <p><a href="#/after-install-behave" target="_blank"> ◀ </a></p>
                </section>

                <section id="simple_test">
                    <h4>A Simple Test</h4>

                    <ul>
                        <li>Let's see a first implementation
                        </li>

                        <li>Given thath we have no real code to test
                            for now, use a simulation</li>

                    </ul>
                </section>

                <section>
                    <h4>Given...</h4>
                    <pre><code>
#!/usr/bin/env python

from behave import *

@given("I have 10000€ in my current acount")
def step_impl(context):
    context.current_account = 10000


@given("I have 300€ in my saving accout")
def step_impl(context):
    context.savings_account = 300                    

                    </code></pre>
                </section>

                <section>
                    <h4>When...</h4>
                    <pre><code>
@when("I transfer 200€ from current to saving")
def step_impl(context):
    context.savings_account += 200
    context.current_account -= 200                    
                    </code></pre>
                </section>

                <section>
                    <h4>Then...</h4>
                    <pre><code>
@then("I should have 9800€ in my current acount")
def step_impl(context):
    assert context.current_account == 9800

@then("I should have 500€ in my saving acount")
def step_impl(context):
    assert context.savings_account == 500                    
                    </code></pre>
                </section>

                <section>
                    <h4>Execute Behave</h4>
                    <pre><code>
Feature: Transfer between accounts # features_002/transfer-between-accounts.feature:1

  Scenario: Add savings                           # features_002/transfer-between-accounts.feature:3
    Given I have 10000€ in my current acount      # features_002/steps/financial.py:5 0.000s
    And I have 300€ in my saving accout           # features_002/steps/financial.py:10 0.000s
    When I transfer 200€ from current to saving   # features_002/steps/financial.py:15 0.000s
    Then I should have 9800€ in my current acount # features_002/steps/financial.py:21 0.000s
    And I should have 500€ in my saving acount    # features_002/steps/financial.py:25 0.000s

1 feature passed, 0 failed, 0 skipped
1 scenario passed, 0 failed, 0 skipped
5 steps passed, 0 failed, 0 skipped, 0 undefined
Took 0m0.000s
                    
                    </code></pre>
                </section>

                <section>
                    <a href="/#after_simple_test">A bit more Theory</a>
                </section>

                <section id="param_test">
                    <h4>Parametrizable steps</h4>
                    <ul>
                        <li>We can parse the example text strings 
                            and get information for the steps </li>
                        <li>The library <a href="https://pypi.org/project/parse/">parse</a>
                            is used by default</li>
                        <li>parse defines itself as <i>the opposite of
                            format()</i></li>
                    </ul>
                </section>

                <section>
                    <p>Change definition of first step from:</p>
                    <pre><code>
@given("I have 10000€ in my current acount")
def step_impl(context):
    context.current_account = 10000                    
                    </code></pre>
                    <p>To:</a></p>
                    <pre><code>
@given("I have {amount}€ in my current acount")
def step_impl(context, amount):
    context.current_account = int(amount)
                    </code></pre>
                </section>

                <section>
                    <pre><code>
Feature: Transfer between accounts # features_003/transfer-between-accounts.feature:1

  Scenario: Add savings                           # features_003/transfer-between-accounts.feature:3
    Given I have 10000€ in my current acount      # features_003/steps/financial.py:5 0.000s
    And I have 300€ in my saving accout           # features_003/steps/financial.py:10 0.000s
    When I transfer 200€ from current to saving   # features_003/steps/financial.py:15 0.000s
    Then I should have 9800€ in my current acount # features_003/steps/financial.py:21 0.000s
    And I should have 500€ in my saving acount    # features_003/steps/financial.py:25 0.000s

1 feature passed, 0 failed, 0 skipped
1 scenario passed, 0 failed, 0 skipped
5 steps passed, 0 failed, 0 skipped, 0 undefined
Took 0m0.001s                    
                    </code></pre>
                </section>

                <section>
                    <h4>We can even forget
                        <br><small>about the integer cast</small></h4>
                    <pre><code>
@given("I have {amount:d}€ in my current acount")
def step_impl(context, amount):
    context.current_account = amount
                    </code></pre>

                </section>

                <section>
                    <h4>Behave have alternative parsers</h4>
                    <ul>
                        <li><b>parse</b> is used by default</li>
                        <li><b>cfparse</b> let us work with cardinality</li>
                        <li><b>re</b> to use regular expressions</li>
                    </ul>
                </section>

                <section>
                    <h3>Table examples</h3>
                    <p>We can add data to the steps in a tabular form</p>
                    <pre><code>
Feature: Pokemon search 

  Scenario: Find the weakest

    Given I have this pokemons
        |name     | attack  | defense |
        |psyduck  | 20      | 60      |
        |torchic  | 20      | 60      |
        |spinda   | 10      | 80      |
        |lillipup | 10      | 50      |
    When I search for the one with less defense
    Then I should get lillipup
                    </code></pre>
                </section>

                <section>
                    <h4>We can process this table
                        <br><small>in the step code</small></h4>
                    <pre><code>
@given('I have this pokemons')
def step_impl(context):
    for row in context.table:
        pokemon = Pokemon(
            row['name'],
            attack=row['attack'],
            defense=row['defense'],
            )
        setattr(context, row['name'], pokemon)
                    </code></pre>

                        <aside class="notes">
                           <p><code>table</code> attribute of the context</p> 
                           <p>We can attach a bunch of text to the example
                           also, use <code>text</code> attribute of the context</p> 
                        </aside>
                </section>

                <section>
                    <h4>We can have shared preconditions
                    <br><small>for all the steps</small>
                    </h4>
                    <pre><code>
 Feature: Transfer between accounts

  Background:
        
    Given I have this pokemons
        |name     | attack  | defense |
        |psyduck  | 20      | 60      |
        |torchic  | 20      | 60      |
        |spinda   | 10      | 80      |
        |lillipup | 10      | 50      |

  Scenario: Search for the weakest 
    When I search for the one with less defense
    Then I should get lillipup

  Scenario: Search for the stronger
    When I search for the one with more attack
    Then I should get spinda                   
                    </code></pre>
                </section>

                <section>
                    <h4>tags</h4>
                    <ul>
                        <li>Selection of scenarios or features</li>
                        <li>Can select for one or several tags</li>
                        <li>Can execute the ones <b>not</b> having one or more tags</li>
                    </ul>
                </section>

                <section>
                    <h4>Feature with tags</h4>
                    <p>Asuming this feature and sample data</p>
                    <pre><code>
 Feature: Search pokemons

  Background:
        
    Given I have this pokemons
        |name     | attack  | defense |
        |psyduck  | 20      | 60      |
        |torchic  | 20      | 60      |
        |trapinch | 20      | 60      |
        |spinda   | 10      | 80      |
        |lillipup | 10      | 50      |

                   
                    </code></pre>



                </section>

                <section>
                    <h4>And this steps</h4>
                    <pre><code>
   @fight
  Scenario: Search for the weakest 
    When I search for the one with less defense
    Then I should get lillipup

  @fight
  Scenario: Search for the stronger
    When I search for the one with more attack
    Then I should get spinda

  Scenario: Search for name 
    When I search for the letter t
    Then I should get torchic
     And I should get trapinch                   
                    </code></pre>
                </section>

                <section>
                    <h4>Executing
                        <br><small>just the fight scenarios</small></h4>
                    <pre><code>
                    behave features_006 --tags=fight
                    </code></pre>
                </section>

                <section>
                    <h4>Executinga all the scenarios
                        <br><small>but the fight ones</small></h4>
                    <pre><code>
                    behave features_006 --tags=-fight
                    </code></pre>
                </section>

                <section>
                    <h4>Works In Progress</h4>
                    <ul>
                        <li>run with <code>-w</code> flag</li>
                        <li>turns off stdout capture</li>
                        <li>turns off logging capture</li>
                        <li>turns off pretty output</li>
                        <li>only runs scenarios tagged with “@wip”</li>
                        <li>stops at the first error</li> 
                    </ul>
                </section>

            </section>

            <section>
                <section>
                <h4>To be handle with care</h4>
                <img src="covers/damage.png" alt="To be handle with care">
                </section>

                <section>
                    <h5>Recomendations</h5>
                    <ul>
                        <li>Don't mix features</li>
                        <li>One scenario to test just one case</li>
                        <li>it's code, store it in the repo</li>
                        <li>High level descriptions: Do not use technology terms</li>
                    </ul>
                </section>

                <section>
                    <h5>Dangers</h5>
                    <ul>
                        <li>Make the system too complex</li>
                        <li>Get used to having some tests never passsing</li>
                        <li>Test the easy ones. You must go for the ones
                        that teaches you the more</li>
                    </ul>
                </section>

                <section>
                    <h5>Rule Number 1 on analisys club</h5>
                    <ul>
                        <li>Don't tell me your solution</li>
                        <li>Instead, tell me your problem</li>
                    </ul>
                    <p><small>(Rule number 2 is Everybody lies, if you are
                            interested)</small></p>
                </section>

                <section>
                    <h5>Tools and options</h5>
                    <ul>
                        <li>Ruby - Cucumber</li>
                        <li>Javascript - Cucumber.js</li>
                        <li>.Net - xBehave </li>
                        <li>Java - JBehave</li>
                    </ul>
                </section>
                <section>
                    <h1>THANK YOU!</h1>
                </section>

            </section>

			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="lib/js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
                history: true,
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
            Reveal.configure({ slideNumber: 'c/t' });
		</script>
	</body>
</html>
